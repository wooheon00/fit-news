<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head><title>ë¡œê·¸ì¸</title></head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<h1>ë¡œê·¸ì¸</h1>

<!-- ê¸°ì¡´ ID/PW ë¡œê·¸ì¸ ê·¸ëŒ€ë¡œ ìœ ì§€ -->
<form id="loginForm">
    <input type="text" id="username" placeholder="ì•„ì´ë””" required><br>
    <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" required><br>
    <button type="submit">ë¡œê·¸ì¸</button>
</form>

<p id="loginMsg"></p>

<hr/>

<!-- ğŸ”¥ ì—¬ê¸°ë§Œ ì¶”ê°€ -->
<h3>ì†Œì…œ ë¡œê·¸ì¸</h3>
<a href="/oauth2/authorization/google">êµ¬ê¸€ë¡œ ë¡œê·¸ì¸</a><br/>
<a href="/oauth2/authorization/kakao">ì¹´ì¹´ì˜¤ë¡œ ë¡œê·¸ì¸</a><br/>

<script>
    document.getElementById("loginForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const data = {
        username: document.getElementById("username").value,
        password: document.getElementById("password").value
    };

    const res = await fetch("/api/auth/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    });

    if (res.status === 200) {
        const result = await res.json();
        localStorage.setItem("accessToken", result.accessToken);
        localStorage.setItem("refreshToken", result.refreshToken);

        if (result.needOnboarding) {
            window.location.href = "/onboarding";
        } else {
            window.location.href = "/";
        }
    } else {
        document.getElementById("loginMsg").innerText = "ë¡œê·¸ì¸ ì‹¤íŒ¨: " + res.status;
    }
});
</script>
</body>
</html>
